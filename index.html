<html>

<head>
    <script src="adapter/adapter.js"></script>
    <script src="https://unpkg.com/peerjs@1.4.7/dist/peerjs.min.js"></script>
    <script>
        const option = {
            video: false,
            audio: true
        }
        var peer;
        window.onload = function () {
            const logElem = document.getElementById("log");
            console.log = msg => logElem.innerHTML += `${msg}<br>`;
            console.error = msg => logElem.innerHTML += `<span class="error">${msg}</span><br>`;
            console.warn = msg => logElem.innerHTML += `<span class="warn">${msg}<span><br>`;
            console.info = msg => logElem.innerHTML += `<span class="info">${msg}</span><br>`;
        }

        function RegisterID() {
            peer = new Peer(document.getElementById("id").value);
            peer.on('open', (id) => console.log("My Id: " + id));
            peer.on('call', function (call) {
                console.log("called");
                call.on('stream', function (stream) {
                    const audioElem = document.querySelector("audio");
                    audioElem.srcObject = stream;
                    console.log("被呼叫成功");
                });
                navigator.mediaDevices.getUserMedia(option).then((stream) => call.answer(stream));
            });
            document.getElementById("RegisterID").disabled = "disabled";
            document.getElementById("Connect").removeAttribute("disabled");
        }
        function Click() {
            // Find the canvas element to capture
            window.alert("确认连接？");


            navigator.mediaDevices.getUserMedia(option).then((stream) => peer.call(document.getElementById("id_conn").value, stream).on('stream', function (stream) {
                const audioElem = document.querySelector("audio");
                audioElem.srcObject = stream;
                console.log("连接成功");
            }));

        }
    </script>
</head>

<body id="errorMsg">
    <!-- <input id="id_Rtext" type="text" value="yourname" /> <button id="RegisterID"
        onclick="RegisterID()">RegisterID</button><br />
    <input id="id_text" type="text" value="chat_name" /> <button id="Connect" onclick="Connect_button()"
        disabled="disabled">Connect</button><br /> -->
    <input id="id" type="text" value="local" /><button id="RegisterID" onclick="RegisterID()">RegisterID</button><br />
    <input id="id_conn" type="text" value="remote" /><button id="Connect" onclick="Click()"
        disabled>Connect</button><br />
    <!-- <video style="border: 1px solid #999;width: 98%;max-width: 860px;" controls autoplay></video><br/> -->
    <audio autoplay></audio>
    <br />
    <strong>Log:</strong>
    <br>
    <pre id="log"></pre>

</body>

</html>